<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tate Academy - Deviate DC 2026</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet CSS & JS for Interactive Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f8fafc;
            color: #334155;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(4px);
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .tab-btn {
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .cal-btn {
            transition: all 0.2s ease;
        }

        .cal-btn:hover {
            transform: translateY(-1px);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .division-junior { background: #fef3c7; color: #92400e; }
        .division-preteen { background: #dbeafe; color: #1e40af; }
        .division-teen { background: #dcfce7; color: #166534; }
        .division-senior { background: #fce7f3; color: #9d174d; }

        .type-solo { background: #fecaca; color: #991b1b; }
        .type-group { background: #bfdbfe; color: #1e40af; }
        .type-line { background: #c7d2fe; color: #3730a3; }
        .type-production { background: #ddd6fe; color: #5b21b6; }
        .type-trio { background: #fbcfe8; color: #9d174d; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-gradient-to-r from-violet-600 to-purple-600 text-white sticky top-0 z-50 shadow-lg">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold tracking-tight">Tate Academy Company</h1>
                    <p class="text-violet-200 text-sm">Deviate (The Process) - Herndon, VA</p>
                    <p class="text-violet-300 text-xs mt-1">February 13-15, 2026</p>
                </div>
                <div id="clock" class="text-sm font-semibold bg-white/20 px-3 py-1 rounded-full"></div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <nav class="max-w-4xl mx-auto px-2 pb-2 flex space-x-1 overflow-x-auto" id="nav-container"></nav>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-4xl mx-auto w-full p-4">
        <div id="content-container"></div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-100 border-t border-slate-200 py-4 mt-8">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <p class="text-xs text-slate-400">Tate Academy Company - Deviate 2026 | Herndon, VA</p>
            <p class="text-xs text-slate-300 mt-1">Go Team!</p>
        </div>
    </footer>

    <script>
        // --- State Management ---
        const state = {
            currentTab: 'schedule',
            ageFilter: 'all'
        };

        // --- Event Information ---
        const eventInfo = {
            name: "Deviate (The Process)",
            location: "Herndon, VA",
            dates: "February 13-15, 2026",
            venue: "Hyatt Regency Dulles",
            venueAddress: "2300 Dulles Corner Blvd, Herndon, VA 20171",
            venueLat: 38.9565,
            venueLng: -77.4089
        };

        // --- Convention Schedule by Age Group ---
        const conventionByAgeGroup = {
            teensSeniors: {
                name: "Teens/Seniors",
                ages: "Ages 13 & Up",
                room: "Luray Ballroom",
                color: "pink",
                saturday: [
                    { time: "7:15 AM", end: "7:45 AM", name: "Registration" },
                    { time: "7:45 AM", end: "8:00 AM", name: "Welcome" },
                    { time: "8:00 AM", end: "9:00 AM", name: "Musical Theatre" },
                    { time: "9:05 AM", end: "10:05 AM", name: "Ballet" },
                    { time: "10:10 AM", end: "11:10 AM", name: "Tap" },
                    { time: "11:10 AM", end: "12:00 PM", name: "Lunch", isBreak: true },
                    { time: "12:00 PM", end: "1:00 PM", name: "Hip Hop" },
                    { time: "1:05 PM", end: "2:05 PM", name: "Lyrical" },
                    { time: "2:30 PM", end: "6:30 PM", name: "Sr. Audition Lab (Ages 15 & Up)", note: "Ages 15+" },
                    { time: "2:30 PM", end: "6:30 PM", name: "Teen Audition Lab (Ages 12-14)", note: "In Jr. Ballroom" },
                    { time: "7:00 PM", end: "7:00 PM", name: "Standouts Announced", note: "In Sr. Ballroom" },
                    { time: "7:00 PM", end: "8:00 PM", name: "Standout Rehearsal" }
                ],
                sunday: [
                    { time: "7:30 AM", end: "9:30 AM", name: "Standout Rehearsal", note: "Sr. Ballroom" },
                    { time: "9:35 AM", end: "10:35 AM", name: "Industry Class" },
                    { time: "10:45 AM", end: "11:45 AM", name: "Jazz" },
                    { time: "11:50 AM", end: "12:50 PM", name: "Contemporary" },
                    { time: "12:50 PM", end: "1:50 PM", name: "Lunch", isBreak: true },
                    { time: "1:50 PM", end: "3:10 PM", name: "Showcase Rehearsal" },
                    { time: "3:15 PM", end: "3:15 PM", name: "Doors Open" },
                    { time: "3:30 PM", end: "5:00 PM", name: "Showcase" }
                ]
            },
            juniors: {
                name: "Juniors",
                ages: "Ages 9-12",
                room: "Cirrus Ballroom",
                color: "yellow",
                saturday: [
                    { time: "7:15 AM", end: "7:45 AM", name: "Registration" },
                    { time: "7:45 AM", end: "8:00 AM", name: "Welcome", note: "In Sr. Ballroom" },
                    { time: "8:00 AM", end: "9:00 AM", name: "Hip Hop" },
                    { time: "9:05 AM", end: "10:05 AM", name: "Lyrical" },
                    { time: "10:10 AM", end: "11:10 AM", name: "Ballet" },
                    { time: "11:10 AM", end: "12:00 PM", name: "Lunch", isBreak: true },
                    { time: "12:00 PM", end: "1:00 PM", name: "Jazz" },
                    { time: "1:05 PM", end: "2:05 PM", name: "Contemporary" },
                    { time: "2:30 PM", end: "6:30 PM", name: "Teen Audition Lab (Ages 12-14)", note: "In Jr. Ballroom" },
                    { time: "7:00 PM", end: "7:00 PM", name: "Standouts Announced", note: "In Sr. Ballroom" },
                    { time: "7:00 PM", end: "8:00 PM", name: "Standout Rehearsal", note: "Teens/Seniors - Sr. Ballroom" }
                ],
                sunday: [
                    { time: "7:30 AM", end: "9:30 AM", name: "Standout Rehearsal", note: "Teens/Seniors - Sr. Ballroom" },
                    { time: "8:00 AM", end: "10:30 AM", name: "Junior Audition Lab (Ages 9-11)", note: "In Jr. Ballroom" },
                    { time: "10:45 AM", end: "11:45 AM", name: "Tap" },
                    { time: "11:50 AM", end: "12:50 PM", name: "Musical Theatre" },
                    { time: "12:50 PM", end: "1:50 PM", name: "Lunch", isBreak: true },
                    { time: "1:50 PM", end: "3:10 PM", name: "Showcase Rehearsal" },
                    { time: "3:15 PM", end: "3:15 PM", name: "Doors Open" },
                    { time: "3:30 PM", end: "5:00 PM", name: "Showcase", note: "Sr. Ballroom" }
                ]
            },
            minis: {
                name: "Minis",
                ages: "Ages 6-8",
                room: "Layton",
                color: "blue",
                saturday: [
                    { time: "7:15 AM", end: "7:45 AM", name: "Registration" },
                    { time: "7:45 AM", end: "8:00 AM", name: "Welcome", note: "In Sr. Ballroom" },
                    { time: "8:00 AM", end: "9:00 AM", name: "Jazz" },
                    { time: "9:05 AM", end: "10:05 AM", name: "Musical Theatre" },
                    { time: "10:10 AM", end: "11:10 AM", name: "Contemporary" },
                    { time: "11:10 AM", end: "12:00 PM", name: "Lunch", isBreak: true },
                    { time: "12:00 PM", end: "1:00 PM", name: "Mini Mania" }
                ],
                sunday: [
                    { time: "9:30 AM", end: "10:30 AM", name: "Mini Mania" },
                    { time: "10:45 AM", end: "11:45 AM", name: "Lyrical" },
                    { time: "11:50 AM", end: "12:50 PM", name: "Hip Hop" },
                    { time: "12:50 PM", end: "1:50 PM", name: "Lunch", isBreak: true },
                    { time: "1:50 PM", end: "3:10 PM", name: "Showcase Rehearsal" },
                    { time: "3:15 PM", end: "3:15 PM", name: "Doors Open" },
                    { time: "3:30 PM", end: "5:00 PM", name: "Showcase", note: "Sr. Ballroom" }
                ]
            },
            parents: {
                name: "Teachers & Parents",
                ages: "",
                room: "Rockbridge Ballroom",
                color: "green",
                saturday: [
                    { time: "8:00 AM", end: "1:00 PM", name: "Studio Director/Teacher Feedback Sessions", note: "*Sign Up On Site*" },
                    { time: "1:05 PM", end: "2:05 PM", name: "Parent Teacher Jazz Class" }
                ],
                sunday: [
                    { time: "8:30 AM", end: "9:30 AM", name: "Parent Teacher Theatre Jazz Class" },
                    { time: "9:35 AM", end: "12:50 PM", name: "Studio Director/Teacher Feedback Sessions", note: "*Sign Up On Site*" }
                ]
            }
        };

        // --- Competition Dance Order (Friday 2/13/26) ---
        const danceOrder = [
            { num: 1, time: "9:00 AM", name: "Raspberry Beret", dancer: "Bella", division: "Junior", style: "Jazz", type: "Solo" },
            { num: 4, time: "9:08 AM", name: "Le Freak", dancer: "Anaya", division: "Junior", style: "Jazz", type: "Solo" },
            { num: 7, time: "9:16 AM", name: "Wings", dancer: "Liana", division: "", style: "", type: "Solo" },
            { num: 22, time: "10:00 AM", name: "Slow It Down", dancer: "Ella B", division: "", style: "", type: "Solo" },
            { num: 25, time: "10:08 AM", name: "Work Me", dancer: "", division: "", style: "", type: "Group" },
            { num: 30, time: "10:23 AM", name: "Just Like A River Does", dancer: "", division: "", style: "", type: "Group" },
            { num: 34, time: "10:37 AM", name: "Fly", dancer: "", division: "", style: "", type: "Group" },
            { num: 41, time: "11:00 AM", name: "White Rabbit", dancer: "", division: "PreTeen", style: "Contemporary", type: "Group" },
            { num: 47, time: "11:19 AM", name: "Know About Me", dancer: "", division: "", style: "", type: "Group" },
            { num: 48, time: "11:55 AM", name: "The Way", dancer: "", division: "PreTeen", style: "Jazz", type: "Group" },
            { num: 53, time: "12:09 PM", name: "What The World Need Now", dancer: "", division: "Teen", style: "Lyrical", type: "Trio" },
            { num: 59, time: "12:28 PM", name: "Hairspray", dancer: "", division: "Mini/Teen", style: "Jazz", type: "Group" },
            { num: null, time: "1:00 PM", name: "Awards 6-12", dancer: "", division: "", style: "", type: "Awards", isAwards: true },
            { num: 64, time: "1:48 PM", name: "Corps", dancer: "", division: "", style: "", type: "Group" },
            { num: 73, time: "2:16 PM", name: "Other Side", dancer: "Carly", division: "Teen", style: "Contemporary", type: "Solo" },
            { num: 74, time: "2:19 PM", name: "When I Go", dancer: "Robbie", division: "PreTeen", style: "Contemporary", type: "Solo" },
            { num: 82, time: "2:43 PM", name: "I Dreamed A Dream", dancer: "Zoe", division: "PreTeen", style: "Lyrical", type: "Solo" },
            { num: 83, time: "2:46 PM", name: "River", dancer: "Eden", division: "PreTeen", style: "Lyrical", type: "Solo" },
            { num: 108, time: "4:20 PM", name: "Winner Takes It All", dancer: "Lula", division: "Senior", style: "Contemporary", type: "Solo" },
            { num: 110, time: "4:26 PM", name: "These Arms Of Mine", dancer: "Chloe", division: "Senior", style: "Contemporary", type: "Solo" },
            { num: 115, time: "4:42 PM", name: "Out There", dancer: "Alina", division: "Senior", style: "Contemporary", type: "Solo" },
            { num: 123, time: "5:08 PM", name: "Dead & Done", dancer: "", division: "Senior", style: "Contemporary", type: "Group" },
            { num: 136, time: "5:57 PM", name: "Tennessee Whiskey", dancer: "Liam", division: "Senior", style: "Contemporary", type: "Solo" },
            { num: 146, time: "6:34 PM", name: "Cry To Me", dancer: "", division: "Senior", style: "Jazz", type: "Group" },
            { num: 150, time: "6:48 PM", name: "End Of Love", dancer: "", division: "Senior", style: "Lyrical", type: "Line" },
            { num: 152, time: "7:30 PM", name: "Golden Years", dancer: "", division: "Teen", style: "Jazz", type: "Production" },
            { num: 156, time: "7:48 PM", name: "Dreams", dancer: "Ella G.", division: "Senior", style: "Jazz", type: "Solo" },
            { num: 164, time: "8:16 PM", name: "Foolish Games", dancer: "Talia G.", division: "Senior", style: "Lyrical", type: "Solo" },
            { num: 166, time: "8:22 PM", name: "One More Second", dancer: "Talya B.", division: "Senior", style: "Lyrical", type: "Solo" },
            { num: 170, time: "8:35 PM", name: "Lose Yourself", dancer: "Riley", division: "Senior", style: "Hip Hop", type: "Solo" },
            { num: 175, time: "8:50 PM", name: "Cellophane", dancer: "", division: "Senior", style: "Lyrical", type: "Group" },
            { num: 179, time: "9:02 PM", name: "Kendrick", dancer: "", division: "Senior", style: "Hip Hop", type: "Group" },
            { num: null, time: "9:40 PM", name: "Awards 13+", dancer: "", division: "", style: "", type: "Awards", isAwards: true }
        ];

        // --- Places to Eat (Near Hyatt Regency Dulles, Herndon VA) ---
        const placesToEat = {
            walkable: [
                { name: "Chili's Grill & Bar", type: "American", distance: "0.1 mi", address: "2250 Centreville Rd, Herndon", price: "$$", lat: 38.9575, lng: -77.4070, note: "Right next to hotel, kid-friendly" },
                { name: "Olive Garden", type: "Italian", distance: "0.2 mi", address: "2285 Centreville Rd, Herndon", price: "$$", lat: 38.9580, lng: -77.4065, note: "Pasta, breadsticks, familiar favorites" },
                { name: "Red Robin", type: "Burgers", distance: "0.3 mi", address: "2200 Centreville Rd, Herndon", price: "$$", lat: 38.9560, lng: -77.4075, note: "Great burgers, bottomless fries" },
                { name: "Founding Farmers", type: "American Farm-to-Table", distance: "1.5 mi", address: "1800 Tysons Blvd, Tysons", price: "$$$", lat: 38.9180, lng: -77.2230, note: "Upscale, great brunch (short drive)" },
                { name: "Pho 75", type: "Vietnamese", distance: "1.2 mi", address: "382 Elden St, Herndon", price: "$", lat: 38.9690, lng: -77.3920, note: "Authentic pho, quick & delicious" },
                { name: "Paisano's Pizza", type: "Pizza/Italian", distance: "1.0 mi", address: "2456 Centreville Rd, Herndon", price: "$$", lat: 38.9620, lng: -77.4050, note: "Great pizza, delivers!" },
                { name: "Jimmy John's", type: "Sandwiches", distance: "0.5 mi", address: "13324 Franklin Farm Rd, Herndon", price: "$", lat: 38.9550, lng: -77.4020, note: "Fast subs, good for quick lunch" }
            ],
            delivery: [
                { name: "Domino's Pizza", type: "Pizza", phone: "(703) 471-7400", apps: ["DoorDash", "UberEats", "Domino's App"] },
                { name: "Chipotle", type: "Mexican", phone: "", apps: ["DoorDash", "UberEats", "Chipotle App"] },
                { name: "Sweetgreen", type: "Salads/Bowls", phone: "", apps: ["DoorDash", "Sweetgreen App"] },
                { name: "CAVA", type: "Mediterranean", phone: "", apps: ["DoorDash", "UberEats", "CAVA App"] },
                { name: "Chick-fil-A", type: "Chicken", phone: "", apps: ["DoorDash", "UberEats", "CFA App"] },
                { name: "Panera Bread", type: "Bakery/Soup/Salad", phone: "", apps: ["DoorDash", "Panera App"] },
                { name: "Jersey Mike's", type: "Subs", phone: "", apps: ["DoorDash", "UberEats", "Jersey Mike's App"] },
                { name: "Nando's Peri-Peri", type: "Chicken", phone: "", apps: ["DoorDash", "UberEats"] }
            ]
        };

        // --- Nearby Activities ---
        const nearbyActivities = [
            { name: "Udvar-Hazy Air & Space Museum", type: "Museum", distance: "3 mi", address: "14390 Air and Space Museum Pkwy, Chantilly", note: "FREE! Space Shuttle Discovery, SR-71 Blackbird, WWII planes. MUST SEE!", icon: "üöÄ", lat: 38.9114, lng: -77.4440 },
            { name: "Reston Town Center", type: "Shopping/Dining", distance: "4 mi", address: "11900 Market St, Reston", note: "Outdoor shopping, restaurants, ice skating rink, movie theater.", icon: "üõçÔ∏è", lat: 38.9586, lng: -77.3590 },
            { name: "Frying Pan Farm Park", type: "Farm/Nature", distance: "5 mi", address: "2709 West Ox Rd, Herndon", note: "FREE! Working farm, animals, playground. Great for younger kids.", icon: "üêÑ", lat: 38.9290, lng: -77.3510 },
            { name: "Dulles Town Center", type: "Mall", distance: "2 mi", address: "21100 Dulles Town Cir, Dulles", note: "Large indoor mall with all the stores. Good rainy day option.", icon: "üè¨", lat: 38.9880, lng: -77.4190 },
            { name: "TopGolf", type: "Entertainment", distance: "8 mi", address: "6625 S Van Dorn St, Alexandria", note: "Fun golf games, food, arcade. Great for teens!", icon: "‚õ≥", lat: 38.7960, lng: -77.1290 },
            { name: "Dave & Buster's", type: "Entertainment", distance: "5 mi", address: "8300 Westpark Dr, Tysons", note: "Arcade games, food, prizes. Perfect for downtime!", icon: "üéÆ", lat: 38.9210, lng: -77.2320 },
            { name: "Historic Downtown Herndon", type: "Town", distance: "3 mi", address: "Downtown Herndon", note: "Cute small town feel, local shops, W&OD Trail access.", icon: "üèòÔ∏è", lat: 38.9696, lng: -77.3867 },
            { name: "Great Falls Park", type: "Nature", distance: "12 mi", address: "9200 Old Dominion Dr, McLean", note: "Stunning waterfalls on the Potomac. $20/car entry. Worth the drive!", icon: "üåä", lat: 38.9985, lng: -77.2540 }
        ];

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderClock();
            renderTabs();
            switchTab('schedule');
            setInterval(renderClock, 60000);
        });

        // --- Functions ---
        function renderClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('clock').textContent = timeString;
        }

        function renderTabs() {
            const tabs = [
                { id: 'schedule', label: 'üìÖ Schedule' },
                { id: 'dances', label: 'üé≠ Dance Order' },
                { id: 'food', label: 'üçΩÔ∏è Places to Eat' },
                { id: 'activities', label: 'üó∫Ô∏è Things to Do' }
            ];

            const nav = document.getElementById('nav-container');
            nav.innerHTML = '';

            tabs.forEach(tab => {
                const btn = document.createElement('button');
                btn.className = `tab-btn flex-shrink-0 px-4 py-2 text-sm font-medium rounded-lg ${state.currentTab === tab.id ? 'active' : 'bg-white/20 text-white hover:bg-white/30'}`;
                btn.textContent = tab.label;
                btn.onclick = () => switchTab(tab.id);
                nav.appendChild(btn);
            });
        }

        function switchTab(tabId) {
            state.currentTab = tabId;
            renderTabs();

            const container = document.getElementById('content-container');

            switch(tabId) {
                case 'schedule':
                    renderSchedule(container);
                    break;
                case 'dances':
                    renderDanceOrder(container);
                    break;
                case 'food':
                    renderFood(container);
                    break;
                case 'activities':
                    renderActivities(container);
                    break;
            }
        }

        // --- Generate Google Calendar Link ---
        function parseTime(timeStr) {
            // Parse time like "7:15 AM" to { hour: 7, minute: 15 }
            const match = timeStr.match(/(\d{1,2}):?(\d{2})?\s*(AM|PM)?/i);
            if (!match) return null;
            let hour = parseInt(match[1]);
            const minute = parseInt(match[2] || '0');
            const period = match[3]?.toUpperCase();

            if (period === 'PM' && hour !== 12) hour += 12;
            if (period === 'AM' && hour === 12) hour = 0;

            return { hour, minute };
        }

        function formatICSDate(dateStr, timeStr) {
            const t = parseTime(timeStr);
            if (!t) return '';
            const d = new Date(dateStr);
            d.setHours(t.hour, t.minute, 0, 0);
            // Format: YYYYMMDDTHHMMSS
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            const hours = String(d.getHours()).padStart(2, '0');
            const minutes = String(d.getMinutes()).padStart(2, '0');
            return `${year}${month}${day}T${hours}${minutes}00`;
        }

        function generateUID() {
            return 'deviate-' + Math.random().toString(36).substr(2, 9) + '@tateacademy';
        }

        function generateICSFile(groupKey) {
            const group = conventionByAgeGroup[groupKey];
            if (!group) return;

            let icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Tate Academy//Deviate DC 2026//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:Deviate - ${group.name}
X-WR-TIMEZONE:America/New_York
`;

            const location = `${group.room}, ${eventInfo.venue}, ${eventInfo.venueAddress}`;

            // Add Saturday events
            group.saturday.forEach(cls => {
                if (cls.isBreak) return; // Skip lunch breaks

                const startDate = formatICSDate('2026-02-14', cls.time);
                const endDate = formatICSDate('2026-02-14', cls.end || cls.time);
                const uid = generateUID();

                icsContent += `BEGIN:VEVENT
UID:${uid}
DTSTART:${startDate}
DTEND:${endDate}
SUMMARY:${cls.name}${cls.note ? ' (' + cls.note + ')' : ''}
LOCATION:${location}
DESCRIPTION:Deviate Convention - ${group.name} ${group.ages}\\n${group.room}${cls.note ? '\\n' + cls.note : ''}
STATUS:CONFIRMED
END:VEVENT
`;
            });

            // Add Sunday events
            group.sunday.forEach(cls => {
                if (cls.isBreak) return; // Skip lunch breaks

                const startDate = formatICSDate('2026-02-15', cls.time);
                const endDate = formatICSDate('2026-02-15', cls.end || cls.time);
                const uid = generateUID();

                icsContent += `BEGIN:VEVENT
UID:${uid}
DTSTART:${startDate}
DTEND:${endDate}
SUMMARY:${cls.name}${cls.note ? ' (' + cls.note + ')' : ''}
LOCATION:${location}
DESCRIPTION:Deviate Convention - ${group.name} ${group.ages}\\n${group.room}${cls.note ? '\\n' + cls.note : ''}
STATUS:CONFIRMED
END:VEVENT
`;
            });

            icsContent += `END:VCALENDAR`;

            // Create and download the file
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Deviate_${group.name.replace(/[^a-zA-Z0-9]/g, '_')}_Schedule.ics`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }

        // --- Render Schedule ---
        function renderSchedule(container) {
            const colorMap = {
                pink: { bg: 'bg-pink-500', light: 'bg-pink-50', border: 'border-pink-200', text: 'text-pink-700' },
                yellow: { bg: 'bg-yellow-500', light: 'bg-yellow-50', border: 'border-yellow-200', text: 'text-yellow-700' },
                blue: { bg: 'bg-blue-500', light: 'bg-blue-50', border: 'border-blue-200', text: 'text-blue-700' },
                green: { bg: 'bg-green-500', light: 'bg-green-50', border: 'border-green-200', text: 'text-green-700' }
            };

            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-violet-50 to-purple-50 p-4 rounded-xl border border-violet-100">
                        <h2 class="text-xl font-bold text-violet-800 mb-2">Convention Schedule</h2>
                        <p class="text-sm text-slate-600">
                            <strong>Venue:</strong> ${eventInfo.venue}<br>
                            <strong>Address:</strong> ${eventInfo.venueAddress}
                        </p>
                        <p class="text-xs text-slate-500 mt-2">Saturday Feb 14 & Sunday Feb 15, 2026</p>
                    </div>

                    <!-- Add to Calendar Buttons by Age Group -->
                    <div class="glass-card rounded-xl p-4">
                        <h3 class="font-bold text-slate-800 mb-2">üìÖ Add Full Schedule to Calendar</h3>
                        <p class="text-xs text-slate-500 mb-3">Downloads a calendar file with each class as a separate event. Import into Google Calendar, Apple Calendar, or Outlook.</p>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                            <button onclick="generateICSFile('teensSeniors')"
                               class="flex items-center justify-center gap-2 bg-pink-500 hover:bg-pink-600 text-white px-4 py-3 rounded-lg font-semibold transition-colors cursor-pointer">
                                <span>üìÜ</span>
                                <span>Teens/Seniors<br><span class="text-xs font-normal opacity-90">Ages 13 & Up</span></span>
                            </button>
                            <button onclick="generateICSFile('juniors')"
                               class="flex items-center justify-center gap-2 bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-3 rounded-lg font-semibold transition-colors cursor-pointer">
                                <span>üìÜ</span>
                                <span>Juniors<br><span class="text-xs font-normal opacity-90">Ages 9-12</span></span>
                            </button>
                            <button onclick="generateICSFile('minis')"
                               class="flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg font-semibold transition-colors cursor-pointer">
                                <span>üìÜ</span>
                                <span>Minis<br><span class="text-xs font-normal opacity-90">Ages 6-8</span></span>
                            </button>
                        </div>
                        <button onclick="generateICSFile('parents')"
                           class="mt-3 w-full flex items-center justify-center gap-2 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-semibold transition-colors text-sm cursor-pointer">
                            <span>üìÜ</span>
                            <span>Teachers & Parents Schedule</span>
                        </button>
                    </div>
            `;

            // Render each age group
            Object.entries(conventionByAgeGroup).forEach(([groupKey, group]) => {
                const colors = colorMap[group.color] || colorMap.pink;

                html += `
                    <div class="glass-card rounded-xl overflow-hidden">
                        <div class="${colors.bg} text-white px-4 py-3">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h3 class="font-bold text-lg">${group.name}</h3>
                                    <p class="text-sm opacity-90">${group.ages}${group.ages ? ' ‚Ä¢ ' : ''}${group.room}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Saturday -->
                        <div class="${colors.light} px-4 py-2 ${colors.border} border-b">
                            <h4 class="font-semibold ${colors.text}">Saturday, Feb 14</h4>
                        </div>
                        <div class="divide-y divide-slate-100">
                `;

                group.saturday.forEach(cls => {
                    const isBreak = cls.isBreak;
                    html += `
                        <div class="p-3 flex items-center hover:bg-slate-50 ${isBreak ? 'bg-slate-50' : ''}">
                            <div class="flex-grow">
                                <div class="flex items-center gap-2">
                                    <span class="font-mono text-sm ${colors.text} font-semibold">${cls.time}${cls.end && cls.end !== cls.time ? ' - ' + cls.end : ''}</span>
                                </div>
                                <div class="font-medium text-slate-800 ${isBreak ? 'text-slate-500 italic' : ''}">${cls.name}</div>
                                ${cls.note ? `<div class="text-xs text-slate-500">${cls.note}</div>` : ''}
                            </div>
                        </div>
                    `;
                });

                html += `
                        </div>

                        <!-- Sunday -->
                        <div class="${colors.light} px-4 py-2 ${colors.border} border-b border-t">
                            <h4 class="font-semibold ${colors.text}">Sunday, Feb 15</h4>
                        </div>
                        <div class="divide-y divide-slate-100">
                `;

                group.sunday.forEach(cls => {
                    const isBreak = cls.isBreak;
                    html += `
                        <div class="p-3 flex items-center hover:bg-slate-50 ${isBreak ? 'bg-slate-50' : ''}">
                            <div class="flex-grow">
                                <div class="flex items-center gap-2">
                                    <span class="font-mono text-sm ${colors.text} font-semibold">${cls.time}${cls.end && cls.end !== cls.time ? ' - ' + cls.end : ''}</span>
                                </div>
                                <div class="font-medium text-slate-800 ${isBreak ? 'text-slate-500 italic' : ''}">${cls.name}</div>
                                ${cls.note ? `<div class="text-xs text-slate-500">${cls.note}</div>` : ''}
                            </div>
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            });

            html += `</div>`;
            container.innerHTML = html;
        }

        // --- Render Dance Order ---
        function renderDanceOrder(container) {
            let html = `
                <div class="space-y-4">
                    <div class="bg-gradient-to-r from-violet-50 to-purple-50 p-4 rounded-xl border border-violet-100">
                        <h2 class="text-xl font-bold text-violet-800 mb-2">Competition Dance Order</h2>
                        <p class="text-sm text-slate-600">Friday, February 13, 2026 - Performance Schedule</p>
                    </div>

                    <div class="glass-card rounded-xl overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-slate-100">
                                    <tr>
                                        <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600">#</th>
                                        <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600">Time</th>
                                        <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600">Routine</th>
                                        <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600">Dancer</th>
                                        <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600">Division</th>
                                        <th class="px-3 py-3 text-left text-xs font-semibold text-slate-600">Type</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;

            danceOrder.forEach(dance => {
                const isAwards = dance.isAwards;
                const rowClass = isAwards
                    ? 'bg-violet-100 font-semibold'
                    : dance.dancer ? 'bg-white hover:bg-slate-50' : 'bg-slate-50 hover:bg-slate-100';

                const divisionClass = dance.division ? `division-${dance.division.toLowerCase().replace('/', '-')}` : '';
                const typeClass = dance.type ? `type-${dance.type.toLowerCase()}` : '';

                html += `
                    <tr class="${rowClass} border-b border-slate-100">
                        <td class="px-3 py-3 text-slate-500 font-mono">${dance.num || '-'}</td>
                        <td class="px-3 py-3 text-violet-600 font-mono font-semibold">${dance.time}</td>
                        <td class="px-3 py-3 text-slate-800 font-medium">${dance.name}</td>
                        <td class="px-3 py-3 ${dance.dancer ? 'text-slate-800 font-semibold' : 'text-slate-400'}">${dance.dancer || '-'}</td>
                        <td class="px-3 py-3">${dance.division ? `<span class="text-xs px-2 py-1 rounded ${divisionClass}">${dance.division}</span>` : '-'}</td>
                        <td class="px-3 py-3">${dance.type && !isAwards ? `<span class="text-xs px-2 py-1 rounded ${typeClass}">${dance.type}</span>` : isAwards ? 'üèÜ' : '-'}</td>
                    </tr>
                `;
            });

            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs">
                        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded division-junior"></span> Junior</div>
                        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded division-preteen"></span> PreTeen</div>
                        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded division-teen"></span> Teen</div>
                        <div class="flex items-center gap-2"><span class="w-3 h-3 rounded division-senior"></span> Senior</div>
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        // --- Render Food ---
        function renderFood(container) {
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-violet-50 to-purple-50 p-4 rounded-xl border border-violet-100">
                        <h2 class="text-xl font-bold text-violet-800 mb-2">Places to Eat</h2>
                        <p class="text-sm text-slate-600">Near ${eventInfo.venue}</p>
                    </div>

                    <!-- Map -->
                    <div class="glass-card rounded-xl overflow-hidden">
                        <div class="p-3 bg-slate-50 border-b border-slate-200">
                            <h3 class="font-semibold text-slate-700">üìç Area Map</h3>
                        </div>
                        <div id="food-map" class="h-64 w-full"></div>
                    </div>

                    <!-- Walkable Restaurants -->
                    <div class="glass-card rounded-xl overflow-hidden">
                        <div class="p-4 bg-green-50 border-b border-green-100">
                            <h3 class="font-bold text-green-800">üö∂ Walking Distance</h3>
                        </div>
                        <div class="divide-y divide-slate-100">
            `;

            placesToEat.walkable.forEach(place => {
                html += `
                    <div class="p-4 hover:bg-slate-50">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-semibold text-slate-800">${place.name}</div>
                                <div class="text-sm text-slate-500">${place.type} ‚Ä¢ ${place.price}</div>
                                <div class="text-xs text-slate-400 mt-1">${place.address}</div>
                                ${place.note ? `<div class="text-xs text-green-600 mt-1">${place.note}</div>` : ''}
                            </div>
                            <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-full">${place.distance}</span>
                        </div>
                    </div>
                `;
            });

            html += `
                        </div>
                    </div>

                    <!-- Delivery Options -->
                    <div class="glass-card rounded-xl overflow-hidden">
                        <div class="p-4 bg-orange-50 border-b border-orange-100">
                            <h3 class="font-bold text-orange-800">üöó Delivery Options</h3>
                        </div>
                        <div class="divide-y divide-slate-100">
            `;

            placesToEat.delivery.forEach(place => {
                html += `
                    <div class="p-4 hover:bg-slate-50">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-semibold text-slate-800">${place.name}</div>
                                <div class="text-sm text-slate-500">${place.type}</div>
                            </div>
                            <div class="flex flex-wrap gap-1 justify-end">
                                ${place.apps.map(app => `<span class="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded">${app}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });

            html += `
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML = html;
            initFoodMap();
        }

        let foodMapInstance = null;

        function initFoodMap() {
            if (foodMapInstance) {
                foodMapInstance.remove();
                foodMapInstance = null;
            }

            const mapContainer = document.getElementById('food-map');
            if (!mapContainer) return;

            foodMapInstance = L.map('food-map').setView([eventInfo.venueLat, eventInfo.venueLng], 15);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap'
            }).addTo(foodMapInstance);

            // Hotel marker
            const hotelIcon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="background: #7c3aed; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); border: 3px solid white;">üè®</div>`,
                iconSize: [36, 36],
                iconAnchor: [18, 18]
            });

            L.marker([eventInfo.venueLat, eventInfo.venueLng], { icon: hotelIcon })
                .addTo(foodMapInstance)
                .bindPopup(`<strong>${eventInfo.venue}</strong><br>${eventInfo.venueAddress}`);

            // Restaurant markers
            placesToEat.walkable.forEach(place => {
                const icon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="background: #22c55e; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); border: 2px solid white;">üçΩÔ∏è</div>`,
                    iconSize: [28, 28],
                    iconAnchor: [14, 14]
                });

                L.marker([place.lat, place.lng], { icon })
                    .addTo(foodMapInstance)
                    .bindPopup(`<strong>${place.name}</strong><br>${place.type} ‚Ä¢ ${place.price}<br><em>${place.distance}</em>`);
            });
        }

        // --- Render Activities ---
        function renderActivities(container) {
            let html = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-violet-50 to-purple-50 p-4 rounded-xl border border-violet-100">
                        <h2 class="text-xl font-bold text-violet-800 mb-2">Things to Do Nearby</h2>
                        <p class="text-sm text-slate-600">Walking distance activities and DC highlights</p>
                    </div>

                    <!-- Map -->
                    <div class="glass-card rounded-xl overflow-hidden">
                        <div class="p-3 bg-slate-50 border-b border-slate-200">
                            <h3 class="font-semibold text-slate-700">üìç Attractions Map</h3>
                        </div>
                        <div id="activities-map" class="h-72 w-full"></div>
                    </div>

                    <!-- Activities List -->
                    <div class="grid gap-4">
            `;

            nearbyActivities.forEach(activity => {
                html += `
                    <div class="glass-card rounded-xl p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start gap-4">
                            <div class="text-3xl">${activity.icon}</div>
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-bold text-slate-800">${activity.name}</h4>
                                        <div class="text-sm text-violet-600">${activity.type}</div>
                                    </div>
                                    <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-full">${activity.distance}</span>
                                </div>
                                <p class="text-sm text-slate-600 mt-2">${activity.note}</p>
                                <p class="text-xs text-slate-400 mt-1">${activity.address}</p>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += `</div></div>`;
            container.innerHTML = html;
            initActivitiesMap();
        }

        let activitiesMapInstance = null;

        function initActivitiesMap() {
            if (activitiesMapInstance) {
                activitiesMapInstance.remove();
                activitiesMapInstance = null;
            }

            const mapContainer = document.getElementById('activities-map');
            if (!mapContainer) return;

            activitiesMapInstance = L.map('activities-map').setView([eventInfo.venueLat, eventInfo.venueLng], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap'
            }).addTo(activitiesMapInstance);

            // Hotel marker
            const hotelIcon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="background: #7c3aed; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); border: 3px solid white;">üè®</div>`,
                iconSize: [36, 36],
                iconAnchor: [18, 18]
            });

            L.marker([eventInfo.venueLat, eventInfo.venueLng], { icon: hotelIcon })
                .addTo(activitiesMapInstance)
                .bindPopup(`<strong>${eventInfo.venue}</strong><br>Home Base`);

            // Activity markers
            nearbyActivities.forEach(activity => {
                const icon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="background: #f59e0b; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); border: 2px solid white;">${activity.icon}</div>`,
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                });

                L.marker([activity.lat, activity.lng], { icon })
                    .addTo(activitiesMapInstance)
                    .bindPopup(`<strong>${activity.name}</strong><br>${activity.note}<br><em>${activity.distance} from hotel</em>`);
            });
        }

    </script>
</body>
</html>
